---
import { getEntry, render } from 'astro:content';
import Page from '@layouts/page/Page.astro';
import { buildRelationsGraph, getBreadcrumbs, getPageRelations } from '@/lib/relations';

const entry = await getEntry('pages', 'index');
if (!entry) {
  return Astro.redirect('/404');
}

const { Content, headings } = await render(entry);
const { data } = entry;

// Build relations graph
const { graph, pages } = await buildRelationsGraph();
const breadcrumbs = getBreadcrumbs('index', graph, pages);
const relations = getPageRelations('index', graph);
---

<Page
  title={data.title}
  description={data.description}
  created={data.created}
  modified={data.modified}
  headings={headings}
  breadcrumbs={breadcrumbs}
  currentSlug="index"
  relations={relations}
  pageInfoMap={pages}
>
  <Content />
</Page>
